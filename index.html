<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DEPANN'FROID - Factures & Documents</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
   @media print {
    .no-print { display: none !important; }
    body { 
        background: white !important;
        margin: 0 !important;
        padding: 8mm !important;
    }
    #system-header { display: none !important; }
    
    /* Optimisation A4 - Meilleur remplissage */
    .container { 
        max-width: 100% !important;
        padding: 0 !important;
        margin: 0 !important;
        min-height: 277mm !important; /* Hauteur A4 */
    }
    
    /* En-t√™te bien visible */
    h1 { 
        font-size: 32px !important; 
        margin-bottom: 6px !important;
        line-height: 1.2 !important;
    }
    h2 { 
        font-size: 24px !important; 
        margin-bottom: 6px !important;
        line-height: 1.2 !important;
    }
    h3 { 
        font-size: 16px !important; 
        margin-bottom: 5px !important;
        line-height: 1.3 !important;
    }
    
    /* Texte lisible */
    p { 
        font-size: 12px !important; 
        margin: 4px 0 !important;
        line-height: 1.4 !important;
    }
    
    /* Tableaux bien espac√©s */
    table { 
        font-size: 11px !important;
        margin: 12px 0 !important;
    }
    th { 
        padding: 8px 6px !important;
        line-height: 1.3 !important;
    }
    td { 
        padding: 6px !important;
        line-height: 1.3 !important;
    }
    
    /* Marges optimales */
    .mb-8, .my-8 { margin-bottom: 12px !important; margin-top: 0 !important; }
    .mb-6, .my-6 { margin-bottom: 10px !important; margin-top: 0 !important; }
    .mb-4, .my-4 { margin-bottom: 8px !important; margin-top: 0 !important; }
    .mb-3, .my-3 { margin-bottom: 6px !important; margin-top: 0 !important; }
    .mb-2, .my-2 { margin-bottom: 4px !important; margin-top: 0 !important; }
    
    .mt-8 { margin-top: 12px !important; }
    .mt-6 { margin-top: 10px !important; }
    .mt-4 { margin-top: 8px !important; }
    .mt-3 { margin-top: 6px !important; }
    .mt-2 { margin-top: 4px !important; }
    .mt-12 { margin-top: 16px !important; }
    
    /* Paddings bien proportionn√©s */
    .p-8 { padding: 12px !important; }
    .p-6 { padding: 10px !important; }
    .p-4 { padding: 8px !important; }
    .p-3 { padding: 6px !important; }
    
    .py-4 { padding-top: 6px !important; padding-bottom: 6px !important; }
    .py-3 { padding-top: 5px !important; padding-bottom: 5px !important; }
    .py-2 { padding-top: 4px !important; padding-bottom: 4px !important; }
    
    .px-4 { padding-left: 8px !important; padding-right: 8px !important; }
    
    /* Bordure cadre bien visible */
    .border-4 { border-width: 3px !important; }
    
    /* Sections totaux espac√©es */
    .totaux { padding: 12px !important; margin: 12px 0 !important; }
    .totaux > div { padding: 4px 0 !important; font-size: 12px !important; }
    
    /* Total TTC bien visible */
    .total-ttc { padding: 10px !important; font-size: 16px !important; }
    
    /* Zone signature proportionn√©e */
    .h-20 { height: 60px !important; }
    
    /* Infos client/footer espac√©es */
    .bg-slate-50, .bg-blue-50, .border-t-2 { 
        padding: 10px !important;
        margin: 10px 0 !important;
    }
    
    /* Conditions et footer bien lisibles */
    .text-xs { font-size: 10px !important; }
    .text-sm { font-size: 11px !important; }
    
    /* Espacement vertical global optimis√© */
    .space-y-6 > * + * { margin-top: 10px !important; }
    .space-y-4 > * + * { margin-top: 8px !important; }
    .space-y-2 > * + * { margin-top: 4px !important; }
    
    /* Garantir 1 page */
    @page {
        size: A4;
        margin: 0;
    }
       /* ========================================
       OPTIMISATION SP√âCIFIQUE FACTURE
       ======================================== */
    
    #facture-content {
        min-height: 270mm !important;
        display: flex !important;
        flex-direction: column !important;
    }
    
    #facture-content .border-4 {
        flex: 1 !important;
        display: flex !important;
        flex-direction: column !important;
        justify-content: space-between !important;
    }
    
    /* En-t√™te facture plus espac√© */
    #facture-content h2 {
        font-size: 28px !important;
        margin-bottom: 8px !important;
    }
    
    /* Infos client plus a√©r√©es */
    #facture-content .bg-slate-50 {
        padding: 14px !important;
        margin-bottom: 16px !important;
    }
    
    /* Tableau facture avec plus d'espace */
    #facture-content table {
        margin: 16px 0 !important;
    }
    
    #facture-content th {
        padding: 10px 8px !important;
        font-size: 12px !important;
    }
    
    #facture-content td {
        padding: 8px !important;
        font-size: 11px !important;
    }
    
    /* Section totaux facture plus grande */
    #facture-content .totaux {
        padding: 16px !important;
        margin: 16px 0 !important;
    }
    
    #facture-content .totaux > div {
        padding: 5px 0 !important;
        font-size: 13px !important;
    }
    
    /* Total TTC facture bien visible */
    #facture-content .bg-blue-600 {
        padding: 12px !important;
        font-size: 18px !important;
    }
    
    /* Reste √† payer bien visible */
    #facture-content .bg-green-600 {
        padding: 12px !important;
        font-size: 18px !important;
    }
    
    /* Footer facture espac√© */
    #facture-content .border-t-2 {
        padding: 14px 0 !important;
        margin-top: 20px !important;
    }
    
    #facture-content .border-t-2 p {
        margin: 6px 0 !important;
        line-height: 1.5 !important;
    }
       /* ========================================
       GESTION MULTI-PAGES AVEC ENCADR√âS
       ======================================== */
    
    /* D√©finition des pages */
    @page {
        size: A4;
        margin: 10mm;
    }
    
    /* Container principal - autoriser les sauts */
    #devis-content, #facture-content {
        min-height: auto !important;
    }
    
    /* L'encadr√© bleu principal */
    .border-4.border-blue-600 {
        page-break-inside: auto !important;
        position: relative;
    }
    
    /* Chaque ligne de tableau ne doit pas √™tre coup√©e */
    tbody tr {
        page-break-inside: avoid !important;
        page-break-after: auto !important;
    }
    
    /* Le tableau peut se couper entre les lignes */
    table {
        page-break-inside: auto !important;
    }
    
    /* Les sections importantes ne doivent pas √™tre coup√©es */
    .bg-slate-50, /* Infos client */
    .totaux,      /* Section totaux */
    .bg-blue-50,  /* Conditions */
    .border-t-2   /* Footer */
    {
        page-break-inside: avoid !important;
    }
    
    /* En-t√™te : ne pas s√©parer du reste */
    .flex.justify-between.items-start {
        page-break-after: avoid !important;
    }
    
    /* Si le tableau est long, forcer un saut AVANT les totaux */
    .totaux {
        page-break-before: auto !important;
    }
    
  
}
}
}
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;
        // ‚öôÔ∏è CONFIGURATION - REMPLACE PAR TON URL
   const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzm_2gtAGRRspENa-YKZDfAO7UVJEGSsCkOqIvEKJAaXbQfVS1o81euixHNIWX5ZXfwGA/exec';

        function App() {
            const [activeTab, setActiveTab] = useState('devis');
            const [isLoading, setIsLoading] = useState(false);

            // √âtat pour Devis
            const [devisData, setDevisData] = useState({
                numeroDevis: '',
                dateDevis: new Date().toISOString().split('T')[0],
                validiteDevis: 30,
                clientNom: '',
                clientAdresse: '',
                clientEmail: '',
                clientTelephone: '',
                prestations: [{ reference: '', description: '', type: 'fourniture', quantite: 1, prixUnitaire: '' }],
                montantTotal: 0,
                accompte: 0,
               conditions: 'Devis valable 30 jours. Paiement : 30% √† la commande, 70% √† la livraison.\n\nEn cas de retard de paiement : p√©nalit√©s de 18% annuel (soit 1,5% par mois) + indemnit√© forfaitaire de 4 800 XPF.'
            });

            // √âtat pour Facture
            const [formData, setFormData] = useState({
                numeroFacture: '',
                dateFacture: new Date().toISOString().split('T')[0],
                clientNom: '',
                clientAdresse: '',
                clientEmail: '',
                clientTelephone: '',
                prestations: [{ reference: '', description: '', type: 'fourniture', quantite: 1, prixUnitaire: '' }],
                montantTotal: 0,
                accompte: 0,
                resteAPayer: 0
            });

            // √âtat pour les Lettres AR
            const [lettreARData, setLettreARData] = useState({
                numeroFacture: '',
                dateFacture: '',
                clientNom: '',
                clientAdresse: '',
                montantDu: 0,
                dateEcheance: '',
                joursRetard: 0,
                typeLettre: 'relance1'
            });

           const [signature, setSignature] = useState(
    typeof window !== 'undefined' && localStorage.getItem('depannfroid_signature')
        ? localStorage.getItem('depannfroid_signature')
        : ''
);

// √âtat pour les factures enregistr√©es et notifications
const [facturesEnregistrees, setFacturesEnregistrees] = useState([]);
const [showNotifications, setShowNotifications] = useState(false);

            const handleDevisChange = (e) => {
                const { name, value } = e.target;
                setDevisData(prev => ({
                    ...prev,
                    [name]: value
                }));
            };

            const handleInputChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({
                    ...prev,
                    [name]: value
                }));
            };

            const handleLettreARChange = (e) => {
                const { name, value } = e.target;
                setLettreARData(prev => ({
                    ...prev,
                    [name]: value
                }));
            };

            const addPrestationDevis = () => {
                setDevisData(prev => ({
                    ...prev,
                    prestations: [...prev.prestations, { description: '', quantite: 1, prixUnitaire: 0, type: 'fourniture' }]
                }));
            };

            const removePrestationDevis = (index) => {
                setDevisData(prev => ({
                    ...prev,
                    prestations: prev.prestations.filter((_, i) => i !== index)
                }));
            };

            const updatePrestationDevis = (index, field, value) => {
                setDevisData(prev => {
                    const newPrestations = [...prev.prestations];
                    newPrestations[index][field] = value;
                    return { ...prev, prestations: newPrestations };
                });
            };

            const addPrestation = () => {
                setFormData(prev => ({
                    ...prev,
                    prestations: [...prev.prestations, { description: '', quantite: 1, prixUnitaire: 0, type: 'fourniture' }]
                }));
            };

            const removePrestation = (index) => {
                setFormData(prev => ({
                    ...prev,
                    prestations: prev.prestations.filter((_, i) => i !== index)
                }));
            };

            const updatePrestation = (index, field, value) => {
                setFormData(prev => {
                    const newPrestations = [...prev.prestations];
                    newPrestations[index][field] = value;
                    return { ...prev, prestations: newPrestations };
                });
            };

            const calculateTotalsDevis = () => {
                let fournituresHT = 0;
                let servicesHT = 0;

                devisData.prestations.forEach(p => {
                    const total = (parseFloat(p.quantite) || 0) * (parseFloat(p.prixUnitaire) || 0);
                    if (p.type === 'fourniture') {
                        fournituresHT += total;
                    } else {
                        servicesHT += total;
                    }
                });

                const tvaFournitures = fournituresHT * 0.16;
                const tvaServices = servicesHT * 0.13;
                const total = fournituresHT + servicesHT + tvaFournitures + tvaServices;

                return {
                    fournituresHT,
                    servicesHT,
                    tvaFournitures,
                    tvaServices,
                    totalHT: fournituresHT + servicesHT,
                    totalTVA: tvaFournitures + tvaServices,
                    totalTTC: total
                };
            };

            const calculateTotals = () => {
                let fournituresHT = 0;
                let servicesHT = 0;

                formData.prestations.forEach(p => {
                    const total = (parseFloat(p.quantite) || 0) * (parseFloat(p.prixUnitaire) || 0);
                    if (p.type === 'fourniture') {
                        fournituresHT += total;
                    } else {
                        servicesHT += total;
                    }
                });

                const tvaFournitures = fournituresHT * 0.16;
                const tvaServices = servicesHT * 0.13;
                const totalTTC = fournituresHT + servicesHT + tvaFournitures + tvaServices;
                const resteAPayer = totalTTC - (parseFloat(formData.accompte) || 0);

                return {
                    fournituresHT,
                    servicesHT,
                    tvaFournitures,
                    tvaServices,
                    totalHT: fournituresHT + servicesHT,
                    totalTVA: tvaFournitures + tvaServices,
                    totalTTC,
                    resteAPayer
                };
            };

            const calculateTotalDevis = () => {
                const totals = calculateTotalsDevis();
                setDevisData(prev => ({
                    ...prev,
                    montantTotal: totals.totalTTC.toFixed(0)
                }));
            };

            const calculateTotal = () => {
                const totals = calculateTotals();
                setFormData(prev => ({
                    ...prev,
                    montantTotal: totals.totalTTC.toFixed(0),
                    resteAPayer: totals.resteAPayer.toFixed(0)
                }));
            };

            const generatePDFDevis = () => {
                calculateTotalDevis();
                setTimeout(() => {
                    window.print();
                }, 100);
            };

            const generatePDF = () => {
                calculateTotal();
                setTimeout(() => {
                    window.print();
                }, 100);
            };

           const envoyerEmail = async () => {
       if (!formData.clientEmail) {
           alert('‚ùå Veuillez saisir un email client !');
           return;
       }
       
       if (GOOGLE_SCRIPT_URL === 'COLLE_ICI_TON_URL_GOOGLE_APPS_SCRIPT') {
           alert('‚ö†Ô∏è Configurez votre URL Google Apps Script !');
           return;
       }

       setIsLoading(true);
       const totals = calculateTotals();

       try {
           await fetch(GOOGLE_SCRIPT_URL, {
               method: 'POST',
               mode: 'no-cors',
               headers: { 'Content-Type': 'application/json' },
               body: JSON.stringify({
                   type: 'facture',
                   data: { ...formData, totals }
               })
           });
           alert('‚úÖ Email envoy√© avec succ√®s !');
       } catch (error) {
           alert('‚ùå Erreur d\'envoi. V√©rifiez l\'URL Google Script.');
       } finally {
           setIsLoading(false);
       }
   };
// ‚¨áÔ∏è‚¨áÔ∏è‚¨áÔ∏è AJOUTE CETTE NOUVELLE FONCTION ICI ‚¨áÔ∏è‚¨áÔ∏è‚¨áÔ∏è

const envoyerEmailDevis = async () => {
    if (!devisData.clientEmail) {
        alert('‚ùå Veuillez saisir un email client !');
        return;
    }
    
    if (GOOGLE_SCRIPT_URL === 'COLLE_ICI_TON_URL_GOOGLE_APPS_SCRIPT') {
        alert('‚ö†Ô∏è Configurez votre URL Google Apps Script !');
        return;
    }
    setIsLoading(true);
    const totals = calculateTotalsDevis();
    try {
        await fetch(GOOGLE_SCRIPT_URL, {
            method: 'POST',
            mode: 'no-cors',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                type: 'devis',
                data: { ...devisData, totals }
            })
        });
        alert('‚úÖ Email envoy√© avec succ√®s !');
    } catch (error) {
        alert('‚ùå Erreur d\'envoi. V√©rifiez l\'URL Google Script.');
    } finally {
        setIsLoading(false);
    }
};

            const genererLettreAR = () => {
                alert('üìÑ Lettre AR g√©n√©r√©e avec succ√®s !');
                window.print();
            };

            React.useEffect(() => {
                calculateTotalDevis();
            }, [devisData.prestations]);

            React.useEffect(() => {
                calculateTotal();
            }, [formData.prestations, formData.accompte]);

            // Charger les factures enregistr√©es au d√©marrage
            React.useEffect(() => {
            const saved = localStorage.getItem('depannfroid_factures');
        if (saved) {
            setFacturesEnregistrees(JSON.parse(saved));
        }
    }, []);

            // Calculer les factures en retard
const getFacturesEnRetard = () => {
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    
    return facturesEnregistrees.filter(f => {
        if (f.statut === 'payee') return false;
        const echeance = new Date(f.dateEcheance);
        echeance.setHours(0, 0, 0, 0);
        return echeance < today;
    }).map(f => {
        const echeance = new Date(f.dateEcheance);
        const diffTime = today - echeance;
        const joursRetard = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        
        let niveau = 'warning';
        if (joursRetard > 30) niveau = 'danger';
        if (joursRetard > 45) niveau = 'critical';
        
        return { ...f, joursRetard, niveau };
    }).sort((a, b) => b.joursRetard - a.joursRetard);
};

// Enregistrer une facture pour suivi
const enregistrerFacture = () => {
    const totals = calculateTotals();
    const nouvelleFacture = {
        id: Date.now(),
        numeroFacture: formData.numeroFacture,
        clientNom: formData.clientNom,
        clientEmail: formData.clientEmail,
        montantTTC: totals.totalTTC,
        dateFacture: formData.dateFacture,
        dateEcheance: new Date(new Date(formData.dateFacture).getTime() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
        statut: 'impayee'
    };
    
    const updated = [...facturesEnregistrees, nouvelleFacture];
    setFacturesEnregistrees(updated);
    localStorage.setItem('depannfroid_factures', JSON.stringify(updated));
    alert('‚úÖ Facture enregistr√©e pour suivi !');
};

// Marquer une facture comme pay√©e
const marquerPayee = (id) => {
    const updated = facturesEnregistrees.map(f => 
        f.id === id ? { ...f, statut: 'payee' } : f
    );
    setFacturesEnregistrees(updated);
    localStorage.setItem('depannfroid_factures', JSON.stringify(updated));
};

// Supprimer une facture du suivi
const supprimerFacture = (id) => {
    const updated = facturesEnregistrees.filter(f => f.id !== id);
    setFacturesEnregistrees(updated);
    localStorage.setItem('depannfroid_factures', JSON.stringify(updated));
};

            return (
                <>
                {/* üîî NOTIFICATIONS FACTURES IMPAY√âES */}
<div className="fixed top-4 right-4 z-50 no-print">
    <div className="relative">
        <button
            onClick={() => setShowNotifications(!showNotifications)}
            className="relative bg-white rounded-full p-3 shadow-lg hover:shadow-xl transition border-2 border-slate-200 hover:border-blue-500"
        >
            <span className="text-2xl">üîî</span>
            {getFacturesEnRetard().length > 0 && (
                <span className="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full h-6 w-6 flex items-center justify-center animate-pulse">
                    {getFacturesEnRetard().length}
                </span>
            )}
        </button>
        
        {showNotifications && (
            <div className="absolute right-0 mt-2 w-96 bg-white rounded-xl shadow-2xl border-2 border-slate-200 overflow-hidden">
                <div className="bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-4 py-3">
                    <h3 className="font-bold text-lg">üîî Factures en retard</h3>
                    <p className="text-sm opacity-80">{getFacturesEnRetard().length} facture(s) impay√©e(s)</p>
                </div>
                
                <div className="max-h-80 overflow-y-auto">
                    {getFacturesEnRetard().length === 0 ? (
                        <div className="p-6 text-center text-slate-500">
                            <span className="text-4xl">‚úÖ</span>
                            <p className="mt-2">Aucune facture en retard !</p>
                        </div>
                    ) : (
                        getFacturesEnRetard().map(f => (
                            <div 
                                key={f.id} 
                                className={`p-4 border-b border-slate-100 hover:bg-slate-50 ${
                                    f.niveau === 'critical' ? 'bg-red-50 border-l-4 border-l-red-600' :
                                    f.niveau === 'danger' ? 'bg-orange-50 border-l-4 border-l-orange-500' :
                                    'bg-yellow-50 border-l-4 border-l-yellow-500'
                                }`}
                            >
                                <div className="flex justify-between items-start">
                                    <div className="flex-1">
                                        <p className="font-bold text-slate-800">{f.numeroFacture}</p>
                                        <p className="text-sm text-slate-600">{f.clientNom}</p>
                                        <p className="text-sm font-semibold text-blue-600">
                                            {(f.montantTTC || 0).toLocaleString('fr-FR')} XPF
                                        </p>
                                        <p className={`text-xs font-bold mt-1 ${
                                            f.niveau === 'critical' ? 'text-red-600' :
                                            f.niveau === 'danger' ? 'text-orange-600' :
                                            'text-yellow-600'
                                        }`}>
                                            ‚ö†Ô∏è {f.joursRetard} jour(s) de retard
                                        </p>
                                    </div>
                                    <div className="flex flex-col gap-1">
                                        <button
                                            onClick={() => marquerPayee(f.id)}
                                            className="text-xs bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600"
                                        >
                                            ‚úÖ Pay√©e
                                        </button>
                                        <button
                                            onClick={() => supprimerFacture(f.id)}
                                            className="text-xs bg-slate-300 text-slate-700 px-2 py-1 rounded hover:bg-slate-400"
                                        >
                                            üóëÔ∏è
                                        </button>
                                    </div>
                                </div>
                            </div>
                        ))
                    )}
                </div>
                
             {facturesEnregistrees.length > 0 && (
    <div className="p-3 bg-slate-50 border-t border-slate-200">
        <p className="text-xs text-slate-500 text-center mb-3">
            {facturesEnregistrees.filter(f => f.statut === 'payee').length} pay√©e(s) / {facturesEnregistrees.length} total
        </p>
        
        <div className="flex gap-2 mb-2">
            <button
                onClick={() => {
                    if (confirm('üßπ Supprimer toutes les factures marqu√©es comme pay√©es ?')) {
                        const updated = facturesEnregistrees.filter(f => f.statut !== 'payee');
                        setFacturesEnregistrees(updated);
                        localStorage.setItem('depannfroid_factures', JSON.stringify(updated));
                    }
                }}
                className="flex-1 py-2 px-3 bg-slate-200 text-slate-700 rounded-lg text-xs font-semibold hover:bg-slate-300 transition"
            >
                üßπ Supprimer pay√©es
            </button>
            
            <button
                onClick={() => {
                    if (confirm('üîÑ ATTENTION : Supprimer TOUT le suivi des factures ?\n\nCette action est irr√©versible !')) {
                        setFacturesEnregistrees([]);
                        localStorage.removeItem('depannfroid_factures');
                    }
                }}
                className="flex-1 py-2 px-3 bg-red-100 text-red-700 rounded-lg text-xs font-semibold hover:bg-red-200 transition"
            >
                üîÑ Tout r√©initialiser
            </button>
        </div>
        
        <div className="text-xs text-slate-400 space-y-1">
            <p>üßπ Efface les factures r√©gl√©es, garde les impay√©es</p>
            <p>üîÑ Reset complet (tests, nouvelle ann√©e)</p>
        </div>
                    </div>
                )}
                </div>
            )}
            </div>
        </div>
                
        <div className="container mx-auto p-6 max-w-7xl">
            
                    {/* Header */}
                    <div id="system-header" className="bg-white rounded-2xl shadow-2xl p-8 mb-8">
                        <div className="flex items-center justify-between">
                            <div>
                                <h1 className="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600">
                                    DEPANN'FROID
                                </h1>
                                <p className="text-slate-600 mt-2">Syst√®me de gestion documentaire professionnel</p>
                            </div>
                            <div className="text-right">
                                <p className="text-sm text-slate-500">üìû 87 70 64 75</p>
                                <p className="text-sm text-slate-500">üìß depannfroidmoorea@gmail.com</p>
                                <p className="text-sm text-slate-500">üìç Moorea, Polyn√©sie fran√ßaise</p>
                            </div>
                        </div>
                    </div>

                    {/* Navigation */}
                    <div className="bg-white rounded-2xl shadow-xl p-2 mb-8 no-print">
                        <div className="flex gap-2">
                            {['devis', 'facture', 'rappel', 'lettreAR', 'signature', 'cgv'].map(tab => (
                                <button
                                    key={tab}
                                    onClick={() => setActiveTab(tab)}
                                    className={`flex-1 py-4 px-6 rounded-xl font-semibold transition-all ${
                                        activeTab === tab
                                            ? 'bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg'
                                            : 'text-slate-600 hover:bg-slate-100'
                                    }`}
                                >
                                    {tab === 'devis' && 'üìã Devis'}
                                    {tab === 'facture' && 'üìÑ Facture'}
                                    {tab === 'rappel' && 'üìß Rappel'}
                                    {tab === 'lettreAR' && '‚úâÔ∏è Lettres AR'}
                                    {tab === 'signature' && '‚úçÔ∏è Signature'}
                                    {tab === 'cgv' && 'üìã CGV'}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Content */}
                    <div>
                        {/* DEVIS */}
                        {activeTab === 'devis' && (
                            <div className="space-y-6">
                                {/* Formulaire Devis */}
                                <div className="bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-xl no-print">
                                    <h2 className="text-2xl font-bold text-slate-800 mb-6">üìã Informations du devis</h2>
                                    
                                    <div className="grid md:grid-cols-3 gap-4 mb-6">
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">N¬∞ Devis</label>
                                            <input
                                                type="text"
                                                name="numeroDevis"
                                                value={devisData.numeroDevis}
                                                onChange={handleDevisChange}
                                                className="w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition"
                                                placeholder="DEVIS-2025-001"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Date</label>
                                            <input
                                                type="date"
                                                name="dateDevis"
                                                value={devisData.dateDevis}
                                                onChange={handleDevisChange}
                                                className="w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Validit√© (jours)</label>
                                            <input
                                                type="number"
                                                name="validiteDevis"
                                                value={devisData.validiteDevis}
                                                onChange={handleDevisChange}
                                                className="w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition"
                                            />
                                        </div>
                                    </div>

                                    <h3 className="text-xl font-semibold text-slate-800 mb-4">üë§ Informations client</h3>
                                    <div className="grid md:grid-cols-2 gap-4 mb-6">
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Nom du client</label>
                                            <input
                                                type="text"
                                                name="clientNom"
                                                value={devisData.clientNom}
                                                onChange={handleDevisChange}
                                                className="w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition"
                                                placeholder="Restaurant Le Tropical"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Adresse</label>
                                            <input
                                                type="text"
                                                name="clientAdresse"
                                                value={devisData.clientAdresse}
                                                onChange={handleDevisChange}
                                                className="w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition"
                                                placeholder="BP 123, Papeete"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Email</label>
                                            <input
                                                type="email"
                                                name="clientEmail"
                                                value={devisData.clientEmail}
                                                onChange={handleDevisChange}
                                                className="w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition"
                                                placeholder="contact@restaurant.pf"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">T√©l√©phone</label>
                                            <input
                                                type="tel"
                                                name="clientTelephone"
                                                value={devisData.clientTelephone}
                                                onChange={handleDevisChange}
                                                className="w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition"
                                                placeholder="87 12 34 56"
                                            />
                                        </div>
                                    </div>

                                    <h3 className="text-xl font-semibold text-slate-800 mb-4">üõ†Ô∏è Prestations</h3>
<p className="text-sm text-slate-600 mb-4">üí° TVA : Fourniture = 16% | Service = 13%</p>
{devisData.prestations.map((prestation, index) => (
    <div key={index} className="grid grid-cols-12 gap-3 mb-4 p-4 bg-slate-50 rounded-lg items-end">
        <div className="col-span-2">
            <label className="block text-sm font-medium text-slate-700 mb-2">R√©f.</label>
            <input
                type="text"
                placeholder="REF-001"
                value={prestation.reference || ''}
                onChange={(e) => updatePrestationDevis(index, 'reference', e.target.value)}
                className="w-full px-3 py-2 rounded-lg border-2 border-slate-200 focus:border-blue-500 text-sm"
            />
        </div>
        <div className="col-span-3">
            <label className="block text-sm font-medium text-slate-700 mb-2">Description</label>
            <input
                type="text"
                value={prestation.description}
                onChange={(e) => updatePrestationDevis(index, 'description', e.target.value)}
                className="w-full px-3 py-2 rounded-lg border-2 border-slate-200 focus:border-blue-500"
                placeholder="Installation chambre froide"
            />
        </div>
        <div className="col-span-2">
            <label className="block text-sm font-medium text-slate-700 mb-2">Type</label>
            <select
                value={prestation.type}
                onChange={(e) => updatePrestationDevis(index, 'type', e.target.value)}
                className="w-full px-3 py-2 rounded-lg border-2 border-slate-200 focus:border-blue-500"
            >
                <option value="fourniture">Fourniture (16%)</option>
                <option value="service">Service (13%)</option>
            </select>
        </div>
        <div className="col-span-1">
            <label className="block text-sm font-medium text-slate-700 mb-2">Qt√©</label>
            <input
                type="number"
                value={prestation.quantite}
                onChange={(e) => updatePrestationDevis(index, 'quantite', e.target.value)}
                className="w-full px-3 py-2 rounded-lg border-2 border-slate-200 focus:border-blue-500"
            />
        </div>
        <div className="col-span-2">
            <label className="block text-sm font-medium text-slate-700 mb-2">P.U. (XPF)</label>
            <input
                type="number"
                value={prestation.prixUnitaire}
                onChange={(e) => updatePrestationDevis(index, 'prixUnitaire', e.target.value)}
                className="w-full px-3 py-2 rounded-lg border-2 border-slate-200 focus:border-blue-500"
            />
        </div>
        <div className="col-span-2 flex gap-2">
            {devisData.prestations.length > 1 && (
                <button
                    onClick={() => removePrestationDevis(index)}
                    className="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition"
                >
                    ‚úï
                </button>
            )}
        </div>
    </div>
))}
                                    
                                    <button
                                        onClick={addPrestationDevis}
                                        className="mt-4 px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg font-semibold hover:shadow-lg transition"
                                    >
                                        ‚ûï Ajouter une prestation
                                    </button>

                                    <div className="mt-6">
                                        <label className="block text-sm font-medium text-slate-700 mb-2">Accompte demand√© (XPF)</label>
                                        <input
                                            type="number"
                                            name="accompte"
                                            value={devisData.accompte}
                                            onChange={handleDevisChange}
                                            className="w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition"
                                            placeholder="0"
                                        />
                                    </div>

                                    <div className="mt-6">
                                        <label className="block text-sm font-medium text-slate-700 mb-2">Conditions particuli√®res</label>
                                        <textarea
                                            name="conditions"
                                            value={devisData.conditions}
                                            onChange={handleDevisChange}
                                            rows="3"
                                            className="w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition"
                                        />
                                    </div>

                                    <div className="mt-8 flex gap-4">
                                        <button
                                            onClick={generatePDFDevis}
                                            className="flex-1 py-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl font-bold text-lg hover:shadow-2xl transition"
                                        >
                                            üñ®Ô∏è G√©n√©rer PDF
                                        </button>
                                        <button
                                            onClick={envoyerEmailDevis}
                                            className="flex-1 py-4 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-xl font-bold text-lg hover:shadow-2xl transition"
                                        >
                                            üìß Envoyer par Email
                                        </button>
                                    </div>
                                </div>

                                {/* Aper√ßu Devis */}
                                <div className="bg-white rounded-xl p-8 shadow-xl" id="devis-content">
                                    <div className="border-4 border-blue-600 rounded-xl p-8">
                                        {/* En-t√™te */}
                                        <div className="flex justify-between items-start mb-8">
                                            <div>
                                                <h1 className="text-4xl font-bold text-blue-600 mb-2">DEPANN'FROID</h1>
                                                <p className="text-slate-600">Installation & Maintenance Froid Commercial - Climatisation</p>
                                                <p className="text-base text-slate-700 font-medium mt-2">üìû 87 70 64 75</p>
                                                <p className="text-base text-slate-700 font-medium">üìß depannfroidmoorea@gmail.com</p>
                                                <p className="text-sm text-slate-500">üìç Moorea, Polyn√©sie fran√ßaise</p>
                                            </div>
                                            <div className="text-right">
                                                <h2 className="text-3xl font-bold text-blue-600 mb-2">DEVIS</h2>
                                                <p className="text-slate-600">N¬∞ {devisData.numeroDevis || '---'}</p>
                                                <p className="text-slate-600">Date: {devisData.dateDevis || '---'}</p>
                                                <p className="text-sm text-orange-600 font-semibold mt-2">
                                                    Valable {devisData.validiteDevis} jours
                                                </p>
                                            </div>
                                        </div>

                                        {/* Infos client */}
                                        <div className="bg-slate-50 rounded-lg p-6 mb-8">
                                            <h3 className="font-bold text-slate-800 mb-3">CLIENT:</h3>
                                            <p className="font-semibold text-lg">{devisData.clientNom || '---'}</p>
                                            <p className="text-slate-600">{devisData.clientAdresse || '---'}</p>
                                            <p className="text-slate-600">{devisData.clientEmail || '---'}</p>
                                            <p className="text-slate-600">{devisData.clientTelephone || '---'}</p>
                                        </div>

                                        {/* Tableau prestations */}
                                        <table className="w-full mb-8">
                                        <thead>
                                            <tr className="bg-blue-600 text-white">
                                                <th className="text-left p-4 rounded-tl-lg">R√©f.</th>
                                                <th className="text-left p-4">Description</th>
                                                <th className="text-center p-4">Type</th>
                                                <th className="text-center p-4">Qt√©</th>
                                                <th className="text-right p-4">P.U. (XPF)</th>
                                                <th className="text-right p-4 rounded-tr-lg">Total (XPF)</th>
                                            </tr>
                                        </thead>
                                            <tbody>
                                                {devisData.prestations.map((prestation, index) => (
                                                    <tr key={index} className="border-b border-slate-200">
                                                        <td className="p-4 text-sm text-slate-500">{prestation.reference || '-'}</td>
                                                        <td className="p-4">{prestation.description || '---'}</td>
                                                        <td className="text-center p-4">
                                                            <span className={`px-2 py-1 rounded text-xs font-semibold ${
                                                                prestation.type === 'fourniture' 
                                                                    ? 'bg-purple-100 text-purple-800' 
                                                                    : 'bg-green-100 text-green-800'
                                                            }`}>
                                                                {prestation.type === 'fourniture' ? 'Fourniture' : 'Service'}
                                                            </span>
                                                        </td>
                                                        <td className="text-center p-4">{prestation.quantite}</td>
                                                        <td className="text-right p-4">{(parseFloat(prestation.prixUnitaire) || 0).toLocaleString('fr-FR')}</td>
                                                        <td className="text-right p-4 font-semibold">
                                                            {((parseFloat(prestation.quantite) || 0) * (parseFloat(prestation.prixUnitaire) || 0)).toLocaleString('fr-FR')}
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>

                                        {/* Totaux avec double TVA */}
                                        <div className="flex justify-end mb-8">
                                            <div className="w-96">
                                                {(() => {
                                                    const totals = calculateTotalsDevis();
                                                    return (
                                                        <>
                                                            {totals.fournituresHT > 0 && (
                                                                <>
                                                                    <div className="flex justify-between py-2 border-b border-slate-200">
                                                                        <span className="text-slate-600">Fournitures HT:</span>
                                                                        <span className="font-semibold">{totals.fournituresHT.toLocaleString('fr-FR')} XPF</span>
                                                                    </div>
                                                                    <div className="flex justify-between py-2 border-b border-slate-200">
                                                                        <span className="text-slate-600">TVA Fournitures (16%):</span>
                                                                       <span className="font-semibold">{Math.round(totals.tvaFournitures).toLocaleString('fr-FR')} XPF</span>
                                                                    </div>
                                                                </>
                                                            )}
                                                            {totals.servicesHT > 0 && (
                                                                <>
                                                                    <div className="flex justify-between py-2 border-b border-slate-200">
                                                                        <span className="text-slate-600">Services HT:</span>
                                                                        <span className="font-semibold">{totals.servicesHT.toLocaleString('fr-FR')} XPF</span>
                                                                    </div>
                                                                    <div className="flex justify-between py-2 border-b border-slate-200">
                                                                        <span className="text-slate-600">TVA Services (13%):</span>
                                                                        <span className="font-semibold">{Math.round(totals.tvaServices).toLocaleString('fr-FR')} XPF</span>
                                                                    </div>
                                                                </>
                                                            )}
                                                            <div className="flex justify-between py-2 border-b-2 border-slate-300 font-semibold">
                                                                <span className="text-slate-800">Total HT:</span>
                                                                <span>{totals.totalHT.toLocaleString('fr-FR')} XPF</span>
                                                            </div>
                                                            <div className="flex justify-between py-2 border-b-2 border-slate-300 font-semibold">
                                                                <span className="text-slate-800">Total TVA:</span>
                                                                <span>{Math.round(totals.totalTVA).toLocaleString('fr-FR')} XPF</span>
                                                            </div>
                                                            <div className="flex justify-between py-3 bg-blue-600 text-white px-4 rounded-lg mt-2">
                                                                <span className="font-bold text-lg">TOTAL TTC:</span>
                                                                <span className="font-bold text-xl">{Math.round(totals.totalTTC).toLocaleString('fr-FR')} XPF</span>
                                                            </div>
                                                            {parseFloat(devisData.accompte) > 0 && (
                                                                <div className="flex justify-between py-2 bg-orange-100 px-4 rounded-lg mt-2">
                                                                    <span className="font-semibold text-orange-800">Accompte demand√©:</span>
                                                                    <span className="font-bold text-orange-800">{(parseFloat(devisData.accompte) || 0).toLocaleString('fr-FR')} XPF</span>
                                                                </div>
                                                            )}
                                                        </>
                                                    );
                                                })()}
                                            </div>
                                        </div>

                                        {/* Conditions */}
                                        <div className="bg-blue-50 rounded-lg p-6 mb-6">
                                            <h3 className="font-bold text-slate-800 mb-3">CONDITIONS:</h3>
                                            <p className="text-slate-700 whitespace-pre-line">{devisData.conditions}</p>
                                        </div>

                                        {/* Signature client */}
                                        <div className="border-t-2 border-slate-200 pt-6">
                                            <div className="grid md:grid-cols-2 gap-8">
                                                <div>
                                                    <p className="font-semibold mb-2">Bon pour accord :</p>
                                                    <p className="text-sm text-slate-600 mb-4">Lu et approuv√©</p>
                                                    <div className="border-b-2 border-slate-300 h-20"></div>
                                                    <p className="text-sm text-slate-600 mt-2">Date et signature du client</p>
                                                </div>
                                               <div>
                                                    <p className="font-semibold mb-2">DEPANN'FROID</p>
                                                    {typeof window !== 'undefined' && localStorage.getItem('depannfroid_signature') ? (
                                                        <div className="my-4">
                                                            <p className="text-3xl font-cursive text-slate-700" style={{fontFamily: 'cursive'}}>
                                                                {localStorage.getItem('depannfroid_signature')}
                                                    </p>
                                                </div>
                                            ) : (
                                                <div className="border-b-2 border-slate-300 h-20 mt-8"></div>
                                            )}
                                            <p className="text-sm text-slate-600 mt-2">Signature</p>
                                        </div>
                                            </div>
                                            <p className="text-xs text-slate-500 mt-6 italic">
                                                Ce devis est valable {devisData.validiteDevis} jours. Pour toute question, contactez-nous au 87 70 64 75
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* FACTURE */}
                        {activeTab === 'facture' && (
                            <div className="space-y-6">
                                {/* Formulaire */}
                                <div className="bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-xl no-print">
                                    <h2 className="text-2xl font-bold text-slate-800 mb-6">üìÑ Informations de la facture</h2>
                                    
                                    <div className="grid md:grid-cols-2 gap-4 mb-6">
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">N¬∞ Facture</label>
                                            <input
                                                type="text"
                                                name="numeroFacture"
                                                value={formData.numeroFacture}
                                                onChange={handleInputChange}
                                                className="w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition"
                                                placeholder="FACT-2025-001"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Date</label>
                                            <input
                                                type="date"
                                                name="dateFacture"
                                                value={formData.dateFacture}
                                                onChange={handleInputChange}
                                                className="w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition"
                                            />
                                        </div>
                                    </div>

                                    <h3 className="text-xl font-semibold text-slate-800 mb-4">üë§ Informations client</h3>
                                    <div className="grid md:grid-cols-2 gap-4 mb-6">
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Nom du client</label>
                                            <input
                                                type="text"
                                                name="clientNom"
                                                value={formData.clientNom}
                                                onChange={handleInputChange}
                                                className="w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition"
                                                placeholder="Restaurant Le Tropical"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Adresse</label>
                                            <input
                                                type="text"
                                                name="clientAdresse"
                                                value={formData.clientAdresse}
                                                onChange={handleInputChange}
                                                className="w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition"
                                                placeholder="BP 123, Papeete"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Email</label>
                                            <input
                                                type="email"
                                                name="clientEmail"
                                                value={formData.clientEmail}
                                                onChange={handleInputChange}
                                                className="w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition"
                                                placeholder="contact@restaurant.pf"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">T√©l√©phone</label>
                                            <input
                                                type="tel"
                                                name="clientTelephone"
                                                value={formData.clientTelephone}
                                                onChange={handleInputChange}
                                                className="w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition"
                                                placeholder="87 12 34 56"
                                            />
                                        </div>
                                    </div>

                                   <h3 className="text-xl font-semibold text-slate-800 mb-4">üõ†Ô∏è Prestations</h3>
<p className="text-sm text-slate-600 mb-4">üí° TVA : Fourniture = 16% | Service = 13%</p>
{formData.prestations.map((prestation, index) => (
    <div key={index} className="grid grid-cols-12 gap-3 mb-4 p-4 bg-slate-50 rounded-lg items-end">
        <div className="col-span-2">
            <label className="block text-sm font-medium text-slate-700 mb-2">R√©f.</label>
            <input
                type="text"
                placeholder="REF-001"
                value={prestation.reference || ''}
                onChange={(e) => updatePrestation(index, 'reference', e.target.value)}
                className="w-full px-3 py-2 rounded-lg border-2 border-slate-200 focus:border-blue-500 text-sm"
            />
        </div>
        <div className="col-span-3">
            <label className="block text-sm font-medium text-slate-700 mb-2">Description</label>
            <input
                type="text"
                value={prestation.description}
                onChange={(e) => updatePrestation(index, 'description', e.target.value)}
                className="w-full px-3 py-2 rounded-lg border-2 border-slate-200 focus:border-blue-500"
                placeholder="Installation chambre froide"
            />
        </div>
        <div className="col-span-2">
            <label className="block text-sm font-medium text-slate-700 mb-2">Type</label>
            <select
                value={prestation.type}
                onChange={(e) => updatePrestation(index, 'type', e.target.value)}
                className="w-full px-3 py-2 rounded-lg border-2 border-slate-200 focus:border-blue-500"
            >
                <option value="fourniture">Fourniture (16%)</option>
                <option value="service">Service (13%)</option>
            </select>
        </div>
        <div className="col-span-1">
            <label className="block text-sm font-medium text-slate-700 mb-2">Qt√©</label>
            <input
                type="number"
                value={prestation.quantite}
                onChange={(e) => updatePrestation(index, 'quantite', e.target.value)}
                className="w-full px-3 py-2 rounded-lg border-2 border-slate-200 focus:border-blue-500"
            />
        </div>
        <div className="col-span-2">
            <label className="block text-sm font-medium text-slate-700 mb-2">P.U. (XPF)</label>
            <input
                type="number"
                value={prestation.prixUnitaire}
                onChange={(e) => updatePrestation(index, 'prixUnitaire', e.target.value)}
                className="w-full px-3 py-2 rounded-lg border-2 border-slate-200 focus:border-blue-500"
            />
        </div>
        <div className="col-span-2 flex gap-2">
            {formData.prestations.length > 1 && (
                <button
                    onClick={() => removePrestation(index)}
                    className="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition"
                >
                    ‚úï
                </button>
            )}
        </div>
    </div>
))}
                                    
                                    <button
                                        onClick={addPrestation}
                                        className="mt-4 px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg font-semibold hover:shadow-lg transition"
                                    >
                                        ‚ûï Ajouter une prestation
                                    </button>

                                    <div className="mt-6">
                                        <label className="block text-sm font-medium text-slate-700 mb-2">Accompte vers√© (XPF)</label>
                                        <input
                                            type="number"
                                            name="accompte"
                                            value={formData.accompte}
                                            onChange={handleInputChange}
                                            className="w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition"
                                            placeholder="0"
                                        />
                                    </div>

                                    <div className="mt-8 flex gap-4">
                                        <button
                                            onClick={generatePDF}
                                            className="flex-1 py-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl font-bold text-lg hover:shadow-2xl transition"
                                        >
                                            üñ®Ô∏è G√©n√©rer PDF
                                        </button>
                                        <button
                                            onClick={envoyerEmail}
                                            className="flex-1 py-4 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-xl font-bold text-lg hover:shadow-2xl transition"
                                        >
                                            üìß Envoyer par Email
                                        </button>
                                        <button
                                            onClick={enregistrerFacture}
                                            className="w-full py-3 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-xl font-semibold hover:shadow-xl transition mt-3"
                                        >
                                            üìã Enregistrer pour suivi des paiements
                                        </button>
                                    </div>
                                </div>

                                {/* Aper√ßu Facture */}
                                <div className="bg-white rounded-xl p-8 shadow-xl" id="facture-content">
                                    <div className="border-4 border-blue-600 rounded-xl p-8">
                                        {/* En-t√™te */}
                                        <div className="flex justify-between items-start mb-8">
                                            <div>
                                                <h1 className="text-4xl font-bold text-blue-600 mb-2">DEPANN'FROID</h1>
                                                <p className="text-slate-600">Installation & Maintenance Froid Commercial - Climatisation</p>
                                                <p className="text-base text-slate-700 font-medium mt-2">üìû 87 70 64 75</p>
                                                <p className="text-base text-slate-700 font-medium">üìß depannfroidmoorea@gmail.com</p>
                                                <p className="text-sm text-slate-500">üìç Moorea, Polyn√©sie fran√ßaise</p>
                                            </div>
                                            <div className="text-right">
                                                <h2 className="text-3xl font-bold text-slate-800 mb-2">FACTURE</h2>
                                                <p className="text-slate-600">N¬∞ {formData.numeroFacture || '---'}</p>
                                                <p className="text-slate-600">Date: {formData.dateFacture || '---'}</p>
                                            </div>
                                        </div>

                                        {/* Infos client */}
                                        <div className="bg-slate-50 rounded-lg p-6 mb-8">
                                            <h3 className="font-bold text-slate-800 mb-3">FACTURER √Ä:</h3>
                                            <p className="font-semibold text-lg">{formData.clientNom || '---'}</p>
                                            <p className="text-slate-600">{formData.clientAdresse || '---'}</p>
                                            <p className="text-slate-600">{formData.clientEmail || '---'}</p>
                                            <p className="text-slate-600">{formData.clientTelephone || '---'}</p>
                                        </div>

                                        {/* Tableau prestations */}
                                        <table className="w-full mb-8">
                                            <thead>
                                                    <tr className="bg-blue-600 text-white">
                                                        <th className="text-left p-4 rounded-tl-lg">R√©f.</th>
                                                        <th className="text-left p-4">Description</th>
                                                        <th className="text-center p-4">Type</th>
                                                        <th className="text-center p-4">Qt√©</th>
                                                        <th className="text-right p-4">P.U. (XPF)</th>
                                                        <th className="text-right p-4 rounded-tr-lg">Total (XPF)</th>
                                                    </tr>
                                            </thead>
                                           
                                            <tbody>
                                                {formData.prestations.map((prestation, index) => (
                                                    <tr key={index} className="border-b border-slate-200">
                                                        <td className="p-4 text-sm text-slate-500">{prestation.reference || '-'}</td>
                                                        <td className="p-4">{prestation.description || '---'}</td>
                                                        <td className="text-center p-4">
                                                            <span className={`px-2 py-1 rounded text-xs font-semibold ${
                                                                prestation.type === 'fourniture' 
                                                                    ? 'bg-purple-100 text-purple-800' 
                                                                    : 'bg-green-100 text-green-800'
                                                            }`}>
                                                                {prestation.type === 'fourniture' ? 'Fourniture' : 'Service'}
                                                            </span>
                                                        </td>
                                                        <td className="text-center p-4">{prestation.quantite}</td>
                                                        <td className="text-right p-4">{(parseFloat(prestation.prixUnitaire) || 0).toLocaleString('fr-FR')}</td>
                                                        <td className="text-right p-4 font-semibold">
                                                            {((parseFloat(prestation.quantite) || 0) * (parseFloat(prestation.prixUnitaire) || 0)).toLocaleString('fr-FR')}
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                        
                                        {/* Totaux avec double TVA */}
                                        <div className="flex justify-end mb-8">
                                            <div className="w-96">
                                                {(() => {
                                                    const totals = calculateTotals();
                                                    return (
                                                        <>
                                                            {totals.fournituresHT > 0 && (
                                                                <>
                                                                    <div className="flex justify-between py-2 border-b border-slate-200">
                                                                        <span className="text-slate-600">Fournitures HT:</span>
                                                                        <span className="font-semibold">{totals.fournituresHT.toLocaleString('fr-FR')} XPF</span>
                                                                    </div>
                                                                    <div className="flex justify-between py-2 border-b border-slate-200">
                                                                        <span className="text-slate-600">TVA Fournitures (16%):</span>
                                                                       <span className="font-semibold">{Math.round(totals.tvaFournitures).toLocaleString('fr-FR')} XPF</span>
                                                                    </div>
                                                                </>
                                                            )}
                                                            {totals.servicesHT > 0 && (
                                                                <>
                                                                    <div className="flex justify-between py-2 border-b border-slate-200">
                                                                        <span className="text-slate-600">Services HT:</span>
                                                                        <span className="font-semibold">{totals.servicesHT.toLocaleString('fr-FR')} XPF</span>
                                                                    </div>
                                                                    <div className="flex justify-between py-2 border-b border-slate-200">
                                                                        <span className="text-slate-600">TVA Services (13%):</span>
                                                                        <span className="font-semibold">{Math.round(totals.tvaServices).toLocaleString('fr-FR')} XPF</span>
                                                                    </div>
                                                                </>
                                                            )}
                                                            <div className="flex justify-between py-2 border-b-2 border-slate-300 font-semibold">
                                                                <span className="text-slate-800">Total HT:</span>
                                                                <span>{totals.totalHT.toLocaleString('fr-FR')} XPF</span>
                                                            </div>
                                                            <div className="flex justify-between py-2 border-b-2 border-slate-300 font-semibold">
                                                                <span className="text-slate-800">Total TVA:</span>
                                                                <span>{Math.round(totals.totalTVA).toLocaleString('fr-FR')} XPF</span>
                                                            </div>
                                                            <div className="flex justify-between py-3 bg-blue-600 text-white px-4 rounded-lg mt-2">
                                                                <span className="font-bold text-lg">TOTAL TTC:</span>
                                                                 <span className="font-bold text-xl">{Math.round(totals.totalTTC).toLocaleString('fr-FR')} XPF</span>
                                                            </div>
                                                            {parseFloat(formData.accompte) > 0 && (
                                                                <>
                                                                    <div className="flex justify-between py-2 border-b border-slate-200 mt-2">
                                                                        <span className="text-slate-600">Accompte vers√©:</span>
                                                                        <span className="font-semibold">-{(parseFloat(formData.accompte) || 0).toLocaleString('fr-FR')} XPF</span>
                                                                    </div>
                                                                    <div className="flex justify-between py-3 bg-green-600 text-white px-4 rounded-lg mt-2">
                                                                        <span className="font-bold text-lg">RESTE √Ä PAYER:</span>
                                                                        <span className="font-bold text-xl">{Math.round(totals.resteAPayer).toLocaleString('fr-FR')} XPF</span>
                                                                    </div>
                                                                </>
                                                            )}
                                                        </>
                                                    );
                                                })()}
                                            </div>
                                        </div>

                                        {/* Footer */}
                                        <div className="border-t-2 border-slate-200 pt-6">
                                            <p className="text-sm text-slate-600 mb-2">
                                                <strong>Conditions de paiement:</strong> Paiement √† r√©ception sous 30 jours
                                            </p>
                                            <p className="text-sm text-slate-600 mb-2">
                                                <strong>Mode de r√®glement:</strong> Virement bancaire, ch√®que ou esp√®ces
                                            </p>
                                            <p className="text-sm text-slate-600 mb-2">
                                                <strong>P√©nalit√©s de retard:</strong> 18% annuel (soit 1,5% par mois) + Indemnit√© forfaitaire de 4 800 XPF
                                            </p>
                                            <p className="text-xs text-slate-500 mt-4 italic">
                                                Merci de votre confiance. Pour toute question, contactez-nous au 87 70 64 75
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* RAPPEL EMAIL */}
{activeTab === 'rappel' && (
    <div className="space-y-6">
        <div className="bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-xl no-print">
            <h2 className="text-2xl font-bold text-slate-800 mb-4">üìß Rappel de Paiement (Email Amical)</h2>
            <p className="text-sm text-slate-600 mb-6">
                üí° Email de rappel courtois √† envoyer quelques jours apr√®s l'√©ch√©ance, AVANT les relances AR formelles.
            </p>
            
            <div className="grid md:grid-cols-2 gap-4 mb-6">
                <div>
                    <label className="block text-sm font-medium text-slate-700 mb-2">N¬∞ Facture</label>
                    <input
                        type="text"
                        value={lettreARData.numeroFacture}
                        onChange={(e) => setLettreARData(prev => ({ ...prev, numeroFacture: e.target.value }))}
                        className="w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-blue-500"
                        placeholder="FACT-2025-001"
                    />
                </div>
                <div>
                    <label className="block text-sm font-medium text-slate-700 mb-2">Date facture</label>
                    <input
                        type="date"
                        value={lettreARData.dateFacture}
                        onChange={(e) => setLettreARData(prev => ({ ...prev, dateFacture: e.target.value }))}
                        className="w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-blue-500"
                    />
                </div>
                <div>
                    <label className="block text-sm font-medium text-slate-700 mb-2">Nom du client</label>
                    <input
                        type="text"
                        value={lettreARData.clientNom}
                        onChange={(e) => setLettreARData(prev => ({ ...prev, clientNom: e.target.value }))}
                        className="w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-blue-500"
                        placeholder="Restaurant Le Tropical"
                    />
                </div>
                <div>
                    <label className="block text-sm font-medium text-slate-700 mb-2">Email client</label>
                    <input
                        type="email"
                        value={lettreARData.clientAdresse || ''}
                        onChange={(e) => setLettreARData(prev => ({ ...prev, clientAdresse: e.target.value }))}
                        className="w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-blue-500"
                        placeholder="contact@restaurant.pf"
                    />
                </div>
                <div>
                    <label className="block text-sm font-medium text-slate-700 mb-2">Montant d√ª (XPF)</label>
                    <input
                        type="number"
                        value={lettreARData.montantDu}
                        onChange={(e) => setLettreARData(prev => ({ ...prev, montantDu: e.target.value }))}
                        className="w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-blue-500"
                        placeholder="150000"
                    />
                </div>
                <div>
                    <label className="block text-sm font-medium text-slate-700 mb-2">Date d'√©ch√©ance</label>
                    <input
                        type="date"
                        value={lettreARData.dateEcheance}
                        onChange={(e) => setLettreARData(prev => ({ ...prev, dateEcheance: e.target.value }))}
                        className="w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-blue-500"
                    />
                </div>
            </div>

            <button
    onClick={async () => {
        if (!lettreARData.clientAdresse) {
            alert('‚ùå Veuillez saisir un email client !');
            return;
        }
        if (!lettreARData.numeroFacture) {
            alert('‚ùå Veuillez saisir un num√©ro de facture !');
            return;
        }
        if (!lettreARData.montantDu || parseFloat(lettreARData.montantDu) <= 0) {
            alert('‚ùå Veuillez saisir un montant d√ª valide !');
            return;
        }
        
        if (GOOGLE_SCRIPT_URL === 'COLLE_ICI_TON_URL_GOOGLE_APPS_SCRIPT') {
            alert('‚ö†Ô∏è URL Google Apps Script non configur√©e !');
            return;
        }

        setIsLoading(true);

        try {
            await fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    type: 'rappel',
                    data: {
                        numeroFacture: lettreARData.numeroFacture,
                        dateFacture: lettreARData.dateFacture,
                        dateEcheance: lettreARData.dateEcheance,
                        clientNom: lettreARData.clientNom,
                        clientEmail: lettreARData.clientAdresse,
                        montantDu: lettreARData.montantDu
                    }
                })
            });
            alert('‚úÖ Email de rappel envoy√© avec succ√®s √† ' + lettreARData.clientAdresse + ' !');
        } catch (error) {
            alert('‚ùå Erreur lors de l\'envoi. V√©rifiez votre connexion.');
        } finally {
            setIsLoading(false);
        }
    }}
    className="w-full py-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl font-bold text-lg hover:shadow-2xl transition"
>
    üìß Envoyer le rappel par email
</button>
            
        </div>

        {/* Aper√ßu Email */}
        <div className="bg-white rounded-xl p-8 shadow-xl">
            <div className="max-w-3xl mx-auto border-2 border-slate-200 rounded-lg p-6">
                <div className="mb-8 border-b-2 border-blue-600 pb-4">
                    <h2 className="text-2xl font-bold text-blue-600">DEPANN'FROID</h2>
                    <p className="text-sm text-slate-600">Installation & Maintenance Froid Commercial - Climatisation</p>
                    <p className="text-sm text-slate-600">üìû 87 70 64 75 | üìß depannfroidmoorea@gmail.com</p>
                </div>

                <div className="mb-6">
                    <p className="font-semibold text-slate-800">{lettreARData.clientNom || 'Nom du client'}</p>
                    <p className="text-sm text-slate-500 mt-2">Objet : Rappel facture n¬∞{lettreARData.numeroFacture || '---'}</p>
                </div>

                <div className="space-y-4 text-justify text-slate-700">
                    <p>Bonjour,</p>
                    
                    <p>
                        Nous vous remercions pour votre confiance et esp√©rons que nos services vous ont donn√© 
                        enti√®re satisfaction.
                    </p>
                    
                    <p>
                        Nous constatons que la facture <strong>n¬∞{lettreARData.numeroFacture || '---'}</strong> d'un montant 
                        de <strong className="text-blue-600">{(parseFloat(lettreARData.montantDu) || 0).toLocaleString('fr-FR')} XPF</strong>, √©mise 
                        le {lettreARData.dateFacture || '---'} et √©chue le {lettreARData.dateEcheance || '---'}, 
                        n'a pas encore √©t√© r√©gl√©e.
                    </p>
                    
                    <p>
                        Il s'agit peut-√™tre d'un simple oubli de votre part. Si c'est le cas, nous vous remercions 
                        de bien vouloir proc√©der au r√®glement dans les meilleurs d√©lais.
                    </p>
                    
                    <div className="bg-blue-50 border-l-4 border-blue-600 p-4 my-6 rounded">
                        <p className="font-semibold text-blue-900">üí∞ Montant √† r√©gler : {(parseFloat(lettreARData.montantDu) || 0).toLocaleString('fr-FR')} XPF</p>
                        <p className="text-sm text-blue-800 mt-2">
                            <strong>Mode de paiement :</strong> Virement bancaire, ch√®que ou esp√®ces
                        </p>
                    </div>
                    
                    <p>
                        Si vous avez d√©j√† effectu√© ce r√®glement, veuillez ne pas tenir compte de ce message 
                        et nous en excuser.
                    </p>
                    
                    <p>
                        Pour toute question ou si vous rencontrez des difficult√©s, n'h√©sitez pas √† nous contacter 
                        au <strong>87 70 64 75</strong>.
                    </p>
                    
                    <p className="mt-6">Cordialement,</p>
                    <p className="font-semibold text-slate-800">DEPANN'FROID</p>
                </div>

                <div className="mt-8 pt-6 border-t border-slate-200 text-center text-sm text-slate-500">
                    <p>DEPANN'FROID - Installation & Maintenance Froid Commercial - Climatisation</p>
                    <p>üìû 87 70 64 75 | üìß depannfroidmoorea@gmail.com | üìç Moorea, Polyn√©sie fran√ßaise</p>
                </div>
            </div>
        </div>
    </div>
)}
                        {/* LETTRES AR - Inchang√© */}
                        {activeTab === 'lettreAR' && (
                            <div className="space-y-6">
                                <div className="bg-white/80 backdrop-blur-sm rounded-xl p-6 shadow-xl no-print">
                                    <h2 className="text-2xl font-bold text-slate-800 mb-6">‚úâÔ∏è G√©n√©ration de Lettre AR</h2>
                                    
                                    <div className="grid md:grid-cols-2 gap-4 mb-6">
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Type de lettre</label>
                                            <select
                                                name="typeLettre"
                                                value={lettreARData.typeLettre}
                                                onChange={handleLettreARChange}
                                                className="w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-blue-500"
                                            >
                                                <option value="relance1">1√®re Relance (Courtoise)</option>
                                                <option value="relance2">2√®me Relance (Ferme)</option>
                                                <option value="miseDemeure">Mise en demeure</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">N¬∞ Facture</label>
                                            <input
                                                type="text"
                                                name="numeroFacture"
                                                value={lettreARData.numeroFacture}
                                                onChange={handleLettreARChange}
                                                className="w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-blue-500"
                                                placeholder="FACT-2025-001"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Date facture</label>
                                            <input
                                                type="date"
                                                name="dateFacture"
                                                value={lettreARData.dateFacture}
                                                onChange={handleLettreARChange}
                                                className="w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-blue-500"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Date d'√©ch√©ance</label>
                                            <input
                                                type="date"
                                                name="dateEcheance"
                                                value={lettreARData.dateEcheance}
                                                onChange={handleLettreARChange}
                                                className="w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-blue-500"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Nom du client</label>
                                            <input
                                                type="text"
                                                name="clientNom"
                                                value={lettreARData.clientNom}
                                                onChange={handleLettreARChange}
                                                className="w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-blue-500"
                                                placeholder="Restaurant Le Tropical"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Adresse</label>
                                            <input
                                                type="text"
                                                name="clientAdresse"
                                                value={lettreARData.clientAdresse}
                                                onChange={handleLettreARChange}
                                                className="w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-blue-500"
                                                placeholder="BP 123, Papeete"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Montant d√ª (XPF)</label>
                                            <input
                                                type="number"
                                                name="montantDu"
                                                value={lettreARData.montantDu}
                                                onChange={handleLettreARChange}
                                                className="w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-blue-500"
                                                placeholder="150000"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Jours de retard</label>
                                            <input
                                                type="number"
                                                name="joursRetard"
                                                value={lettreARData.joursRetard}
                                                onChange={handleLettreARChange}
                                                className="w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-blue-500"
                                                placeholder="45"
                                            />
                                        </div>
                                    </div>

                                    <button
                                        onClick={genererLettreAR}
                                        className="w-full py-4 bg-gradient-to-r from-orange-600 to-red-600 text-white rounded-xl font-bold text-lg hover:shadow-2xl transition"
                                    >
                                        üìÑ G√©n√©rer la lettre AR
                                    </button>
                                </div>

                                {/* Aper√ßu Lettre AR - Contenu identique √† V9 */}
                                <div className="bg-white rounded-xl p-8 shadow-xl">
                                    <div className="max-w-3xl mx-auto">
                                        <div className="flex justify-between mb-12">
                                            <div>
                                                <h2 className="text-2xl font-bold text-blue-600">DEPANN'FROID</h2>
                                                <p className="text-sm text-slate-600">87 70 64 75</p>
                                                <p className="text-sm text-slate-600">depannfroidmoorea@gmail.com</p>
                                                <p className="text-sm text-slate-600">Moorea, Polyn√©sie fran√ßaise</p>
                                            </div>
                                            <div className="text-right">
                                                <p className="text-sm text-slate-600">Date: {new Date().toLocaleDateString('fr-FR')}</p>
                                                <p className="text-sm font-bold text-red-600 mt-2">LETTRE RECOMMAND√âE AVEC AR</p>
                                            </div>
                                        </div>

                                        <div className="mb-12">
                                            <p className="font-semibold">{lettreARData.clientNom || '---'}</p>
                                            <p className="text-slate-600">{lettreARData.clientAdresse || '---'}</p>
                                        </div>

                                        <div className="mb-8">
                                            <p className="font-bold">
                                                Objet: {lettreARData.typeLettre === 'relance1' && 'Relance pour facture impay√©e'}
                                                {lettreARData.typeLettre === 'relance2' && 'Derni√®re relance avant action en justice'}
                                                {lettreARData.typeLettre === 'miseDemeure' && 'Mise en demeure de payer'}
                                            </p>
                                            <p className="text-slate-600">
                                                Facture N¬∞ {lettreARData.numeroFacture || '---'} du {lettreARData.dateFacture || '---'}
                                            </p>
                                        </div>

                                        <div className="space-y-4 text-justify mb-8">
                                            {lettreARData.typeLettre === 'relance1' && (
                                                <>
                                                    <p>Madame, Monsieur,</p>
                                                    <p>
                                                        Nous constatons que la facture n¬∞{lettreARData.numeroFacture || '---'} d'un montant de{' '}
                                                        <strong>{(parseFloat(lettreARData.montantDu) || 0).toLocaleString('fr-FR')} XPF</strong>, √©mise le{' '}
                                                        {lettreARData.dateFacture || '---'} et √©chue le {lettreARData.dateEcheance || '---'}, n'a pas √©t√© r√©gl√©e √† ce jour.
                                                    </p>
                                                    <p>
                                                        Il s'agit peut-√™tre d'un simple oubli de votre part. Nous vous remercions de bien vouloir proc√©der au r√®glement 
                                                        dans les plus brefs d√©lais.
                                                    </p>
                                                    <p>
                                                        Si toutefois un probl√®me particulier emp√™chait le r√®glement de cette facture, nous vous invitons √† nous contacter 
                                                        au 87 70 64 75 afin de trouver ensemble une solution.
                                                    </p>
                                                    <p>
                                                        Dans l'attente de votre r√®glement, nous vous prions d'agr√©er, Madame, Monsieur, nos salutations distingu√©es.
                                                    </p>
                                                </>
                                            )}

                                            {lettreARData.typeLettre === 'relance2' && (
                                                <>
                                                    <p>Madame, Monsieur,</p>
                                                    <p>
                                                        Malgr√© notre pr√©c√©dente relance, nous constatons que la facture n¬∞{lettreARData.numeroFacture || '---'} d'un montant de{' '}
                                                        <strong>{(parseFloat(lettreARData.montantDu) || 0).toLocaleString('fr-FR')} XPF</strong> reste impay√©e √† ce jour, 
                                                        soit {lettreARData.joursRetard || '---'} jours apr√®s l'√©ch√©ance du {lettreARData.dateEcheance || '---'}.
                                                    </p>
                                                    <p className="font-semibold text-red-600">
                                                        Nous vous demandons donc de proc√©der au r√®glement de cette facture dans un d√©lai de 8 jours √† compter de la r√©ception 
                                                        de cette lettre.
                                                    </p>
                                                    <p>
                                                        √Ä d√©faut de r√®glement ou de prise de contact dans ce d√©lai, nous nous verrons contraints d'engager une proc√©dure 
                                                        judiciaire √† votre encontre, sans autre avis de notre part.
                                                    </p>
                                                    <p>
                                                        Conform√©ment √† l'article L. 441-6 du Code de commerce, cette cr√©ance portera int√©r√™t au taux l√©gal major√© de 10 points, 
                                                        ainsi qu'une indemnit√© forfaitaire pour frais de recouvrement de 4 800 XPF.
                                                    </p>
                                                    <p>
                                                        Nous esp√©rons que cette situation trouvera une issue rapide et vous prions d'agr√©er, Madame, Monsieur, nos salutations.
                                                    </p>
                                                </>
                                            )}

                                            {lettreARData.typeLettre === 'miseDemeure' && (
                                                <>
                                                    <p>Madame, Monsieur,</p>
                                                    <p className="font-bold text-red-600 text-lg">MISE EN DEMEURE DE PAYER</p>
                                                    <p>
                                                        Par la pr√©sente, nous vous mettons formellement en demeure de proc√©der au r√®glement de la facture n¬∞{lettreARData.numeroFacture || '---'} 
                                                        d'un montant de <strong className="text-red-600">{(parseFloat(lettreARData.montantDu) || 0).toLocaleString('fr-FR')} XPF</strong>, 
                                                        √©mise le {lettreARData.dateFacture || '---'} et √©chue depuis le {lettreARData.dateEcheance || '---'}.
                                                    </p>
                                                    <p>
                                                        √Ä ce jour, soit {lettreARData.joursRetard || '---'} jours apr√®s l'√©ch√©ance, cette facture demeure impay√©e malgr√© nos pr√©c√©dentes relances.
                                                    </p>
                                                    <p className="font-semibold bg-yellow-100 p-4 rounded-lg border-l-4 border-red-600">
                                                        Vous disposez d'un d√©lai de 8 jours √† compter de la r√©ception de cette mise en demeure pour proc√©der au r√®glement int√©gral 
                                                        de cette cr√©ance.
                                                    </p>
                                                    <p className="font-semibold">
                                                        Pass√© ce d√©lai, nous engagerons sans autre avis:
                                                    </p>
                                                    <ul className="list-disc ml-8 space-y-2">
                                                        <li>Une proc√©dure d'injonction de payer devant le Tribunal comp√©tent</li>
                                                        <li>L'application de p√©nalit√©s de retard au taux l√©gal major√© de 10 points</li>
                                                        <li>Le paiement d'une indemnit√© forfaitaire de 4 800 XPF pour frais de recouvrement</li>
                                                        <li>La facturation des frais de justice et d'avocat</li>
                                                    </ul>
                                                    <p className="font-semibold text-red-600 mt-6">
                                                        Cette mise en demeure constitue le dernier avertissement avant l'engagement de poursuites judiciaires.
                                                    </p>
                                                    <p className="mt-6">
                                                        Veuillez agr√©er, Madame, Monsieur, nos salutations.
                                                    </p>
                                                </>
                                            )}
                                        </div>

                                        <div className="mt-12">
                                            <p className="font-semibold">DEPANN'FROID</p>
                                            <p className="text-slate-600 mt-8">Signature:</p>
                                            <div className="h-20 border-b-2 border-slate-300 mt-2"></div>
                                        </div>

                                        <div className="mt-12 bg-red-50 border-2 border-red-300 rounded-lg p-6">
                                            <h3 className="font-bold text-red-800 mb-4">MONTANTS EXIGIBLES:</h3>
                                            <div className="space-y-2">
                                                <div className="flex justify-between">
                                                    <span>Principal :</span>
                                                    <span className="font-semibold">{(parseFloat(lettreARData.montantDu) || 0).toLocaleString('fr-FR')} XPF</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span>P√©nalit√©s (18% annuel) :</span>
                                                    <span className="font-semibold">{(parseFloat(lettreARData.montantDu) * 0.18).toFixed(0)} XPF</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span>Indemnit√© :</span>
                                                    <span className="font-semibold">4 800 XPF</span>
                                                </div>
                                                <div className="flex justify-between pt-3 border-t-2 border-red-400">
                                                    <span className="font-bold text-lg">TOTAL :</span>
                                                    <span className="font-bold text-lg text-red-600">
                                                       {Math.round(parseFloat(lettreARData.montantDu) + parseFloat(lettreARData.montantDu) * 0.18 + 4800).toLocaleString('fr-FR')} XPF
                                                    </span>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="mt-8 text-xs text-slate-500 border-t pt-4">
                                            <p className="mb-2"><strong>R√©f√©rences l√©gales :</strong></p>
                                            <p className="mb-1">- Article L. 441-6 du Code de commerce (p√©nalit√©s de retard)</p>
                                            <p className="mb-1">- D√©cret n¬∞ 2012-1115 du 2 octobre 2012 (indemnit√© forfaitaire)</p>
                                            <p>- Article 1231-6 du Code civil (int√©r√™ts moratoires)</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* SIGNATURE - Inchang√© */}
                        {activeTab === 'signature' && (
                            <div className="space-y-6">
                                <div className="bg-white/70 backdrop-blur-sm rounded-xl p-6 shadow-xl no-print">
                                    <h2 className="text-xl font-semibold text-slate-800 mb-4">‚úçÔ∏è Signature Num√©rique</h2>
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Tapez votre signature</label>
                                            <input
                                                type="text"
                                                value={signature}
                                                onChange={(e) => setSignature(e.target.value)}
                                                className="w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-blue-500 text-2xl font-cursive"
                                                placeholder="Votre nom..."
                                            />
                                        </div>
                                        <button
                                            onClick={() => {
                                                if (signature) {
                                                    localStorage.setItem('depannfroid_signature', signature);
                                                    alert('‚úÖ Signature enregistr√©e !');
                                                } else {
                                                    alert('‚ùå Veuillez taper votre signature d\'abord !');
                                                }
                                            }}
                                            className="w-full bg-green-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-green-700 transition"
                                        >
                                            Enregistrer la signature
                                        </button>
                                    </div>
                                </div>

                                <div className="bg-white/70 backdrop-blur-sm rounded-xl p-6 shadow-xl border border-white/20">
                                    <h2 className="text-xl font-semibold text-slate-800 mb-4">üëÅÔ∏è Pr√©visualisation</h2>
                                    <div className="bg-slate-50 rounded-lg p-6 border-2 border-slate-200">
                                        <p className="text-sm text-slate-600 mb-4">Votre signature appara√Ætra ainsi :</p>
                                        <div className="border-t-2 border-slate-300 pt-4">
                                            <div className="text-center">
                                                <p className="text-sm text-slate-500 mb-2">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</p>
                                                <p className="font-semibold text-slate-800">SIGNATURE NUM√âRIQUE</p>
                                                <p className="text-slate-700 my-2 text-3xl font-cursive">{signature || 'Votre signature...'}</p>
                                                <p className="text-xs text-slate-400 mt-2">{new Date().toLocaleString('fr-FR')}</p>
                                                <p className="text-sm text-slate-500 mt-2">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* CGV - Inchang√© */}
                        {activeTab === 'cgv' && (
                            <div className="bg-white rounded-xl p-8 shadow-xl">
                                <div className="max-w-4xl mx-auto">
                                    <h1 className="text-3xl font-bold text-slate-800 mb-8 text-center">
                                        CONDITIONS G√âN√âRALES DE VENTE
                                    </h1>
                                    <p className="text-center text-slate-600 mb-8">DEPANN'FROID - Installation & Maintenance Froid Commercial - Climatisation </p>

                                    <div className="space-y-6 text-justify">
                                        <section>
                                            <h2 className="text-xl font-bold text-slate-800 mb-3">1. CHAMP D'APPLICATION</h2>
                                            <p className="text-slate-700 leading-relaxed">
                                                Les pr√©sentes conditions g√©n√©rales de vente s'appliquent √† l'ensemble des prestations de services r√©alis√©es 
                                                par DEPANN'FROID, entreprise sp√©cialis√©e dans l'installation, la maintenance et le d√©pannage de syst√®mes de 
                                                r√©frig√©ration commerciale et industrielle en Polyn√©sie fran√ßaise.
                                            </p>
                                        </section>

                                        <section>
                                            <h2 className="text-xl font-bold text-slate-800 mb-3">2. DEVIS ET COMMANDES</h2>
                                            <p className="text-slate-700 leading-relaxed mb-2">
                                                Tout devis √©tabli par DEPANN'FROID est valable 30 jours √† compter de sa date d'√©mission. Pass√© ce d√©lai, 
                                                les prix pourront √™tre r√©vis√©s. La commande ne devient ferme et d√©finitive qu'apr√®s acceptation √©crite du 
                                                devis par le client et versement de l'accompte √©ventuel.
                                            </p>
                                        </section>

                                        <section>
                                            <h2 className="text-xl font-bold text-slate-800 mb-3">3. PRIX</h2>
                                            <p className="text-slate-700 leading-relaxed">
                                                Les prix sont exprim√©s en Francs Pacifique (XPF) et s'entendent toutes taxes comprises. Ils incluent la 
                                                main-d'≈ìuvre, les d√©placements dans un rayon de 20 km et les fournitures mentionn√©es au devis. Toute 
                                                prestation suppl√©mentaire fera l'objet d'un devis compl√©mentaire.
                                            </p>
                                        </section>

                                        <section>
                                            <h2 className="text-xl font-bold text-slate-800 mb-3">4. CONDITIONS DE PAIEMENT</h2>
                                            <p className="text-slate-700 leading-relaxed mb-3">
                                                Sauf convention contraire, le paiement est exigible √† r√©ception de la facture, selon les modalit√©s suivantes :
                                            </p>
                                            <ul className="list-disc ml-8 space-y-2 text-slate-700">
                                                <li>Pour les installations : 30% √† la commande, 70% √† la livraison</li>
                                                <li>Pour les interventions de d√©pannage : paiement comptant √† l'issue de l'intervention</li>
                                                <li>Pour les contrats de maintenance : paiement mensuel ou annuel selon accord</li>
                                            </ul>
                                            <p className="text-slate-700 leading-relaxed mt-3">
                                                Modes de r√®glement accept√©s : virement bancaire, ch√®que, esp√®ces (dans la limite l√©gale).
                                            </p>
                                        </section>

                                        <section>
                                            <h2 className="text-xl font-bold text-slate-800 mb-3">5. RETARD DE PAIEMENT</h2>
                                            <p className="text-slate-700 leading-relaxed mb-3">
                                                En cas de retard de paiement, le client s'expose aux p√©nalit√©s suivantes :
                                            </p>
                                            <ul className="list-disc ml-8 space-y-2 text-slate-700">
                                                <li>Int√©r√™ts de retard au taux l√©gal en vigueur major√© de 10 points</li>
                                                <li>Indemnit√© forfaitaire pour frais de recouvrement : 4 800 XPF</li>
                                                <li>Suspension des prestations en cours jusqu'√† r√©gularisation</li>
                                                <li>Action judiciaire en cas de non-r√®glement</li>
                                            </ul>
                                        </section>

                                        <section>
                                            <h2 className="text-xl font-bold text-slate-800 mb-3">6. GARANTIES</h2>
                                            <p className="text-slate-700 leading-relaxed mb-2">
                                                Les prestations de DEPANN'FROID sont garanties selon les conditions suivantes :
                                            </p>
                                            <ul className="list-disc ml-8 space-y-2 text-slate-700">
                                                <li>Pi√®ces d√©tach√©es : garantie constructeur (g√©n√©ralement 1 √† 2 ans)</li>
                                                <li>Main-d'≈ìuvre : garantie 6 mois sur les interventions</li>
                                                <li>Installations neuves : garantie 1 an pi√®ces et main-d'≈ìuvre</li>
                                            </ul>
                                            <p className="text-slate-700 leading-relaxed mt-3">
                                                La garantie ne s'applique pas en cas de mauvais usage, d√©faut d'entretien, modification non autoris√©e 
                                                ou intervention par un tiers non agr√©√©.
                                            </p>
                                        </section>

                                        <section>
                                            <h2 className="text-xl font-bold text-slate-800 mb-3">7. RESPONSABILIT√â</h2>
                                            <p className="text-slate-700 leading-relaxed">
                                                DEPANN'FROID est couvert par une assurance responsabilit√© civile professionnelle. Notre responsabilit√© 
                                                est limit√©e au montant de la prestation factur√©e. Le client reste responsable de la bonne utilisation 
                                                et de l'entretien r√©gulier de ses √©quipements.
                                            </p>
                                        </section>

                                        <section>
                                            <h2 className="text-xl font-bold text-slate-800 mb-3">8. ANNULATION</h2>
                                            <p className="text-slate-700 leading-relaxed">
                                                Toute annulation d'intervention doit √™tre notifi√©e au moins 24h √† l'avance. En cas d'annulation tardive 
                                                ou de d√©placement pour absence du client, des frais de d√©placement pourront √™tre factur√©s.
                                            </p>
                                        </section>

                                        <section>
                                            <h2 className="text-xl font-bold text-slate-800 mb-3">9. PROTECTION DES DONN√âES</h2>
                                            <p className="text-slate-700 leading-relaxed">
                                                Les donn√©es personnelles collect√©es sont utilis√©es uniquement pour la gestion commerciale et ne sont 
                                                jamais communiqu√©es √† des tiers. Conform√©ment √† la r√©glementation, le client dispose d'un droit d'acc√®s, 
                                                de rectification et de suppression de ses donn√©es.
                                            </p>
                                        </section>

                                        <section>
                                            <h2 className="text-xl font-bold text-slate-800 mb-3">10. LITIGES</h2>
                                            <p className="text-slate-700 leading-relaxed">
                                                En cas de litige, les parties s'engagent √† rechercher une solution amiable. √Ä d√©faut d'accord, les 
                                                tribunaux de Papeete seront seuls comp√©tents. Le droit applicable est le droit fran√ßais.
                                            </p>
                                        </section>

                                        <div className="mt-12 pt-6 border-t-2 border-slate-200">
                                            <p className="text-sm text-slate-600 italic">
                                                Date de derni√®re mise √† jour : {new Date().toLocaleDateString('fr-FR')}
                                            </p>
                                            <p className="text-sm text-slate-600 mt-2">
                                                <strong>DEPANN'FROID</strong><br />
                                                Moorea, Polyn√©sie fran√ßaise<br />
                                                T√©l : 87 70 64 75<br />
                                                Email : depannfroidmoorea@gmail.com
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                        {/* Loading Overlay */}
                        {isLoading && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 no-print">
                                <div className="bg-white rounded-xl p-8 flex flex-col items-center">
                                    <div className="animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 mb-4"></div>
                                    <p className="text-lg font-semibold text-slate-800">Envoi en cours...</p>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
              </>      
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
